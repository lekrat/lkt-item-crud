(function(e,p){typeof exports=="object"&&typeof module<"u"?module.exports=p(require("vue"),require("lkt-http-client"),require("lkt-data-state")):typeof define=="function"&&define.amd?define(["vue","lkt-http-client","lkt-data-state"],p):(e=typeof globalThis<"u"?globalThis:e||self,e.LktItemCrud=p(e.Vue,e.LktHttpClient,e.LktDataState))})(this,function(e,p,w){"use strict";const _={class:"lkt-item-crud"},q={key:0,class:"lkt-item-crud_header"},L={class:"lkt-item-crud_header-title"},R={class:"lkt-item-crud_header-slot"},E={class:"lkt-item-crud-buttons"},N={key:1},I={key:1},T={key:1,class:"lkt-item-crud_content"},x={key:0,class:"lkt-grid-1"},M={name:"LktItemCrud",inheritAttrs:!1},O=e.defineComponent({...M,props:{modelValue:{type:Object,required:!1,default:()=>({})},title:{type:String,default:""},editModeText:{type:String,default:"Edition Mode"},saveText:{type:String,default:"Save"},dropText:{type:String,default:"Delete"},readResource:{type:String,required:!0},createResource:{type:String,required:!1},updateResource:{type:String,required:!1},dropResource:{type:String,required:!1},readData:{type:Object,required:!1,default:()=>({})},createData:{type:Object,required:!1,default:()=>({})},updateData:{type:Object,required:!1,default:()=>({})},dropData:{type:Object,required:!1,default:()=>({})},isCreate:{type:Boolean,default:!1},createConfirm:{type:String,default:""},updateConfirm:{type:String,default:""},dropConfirm:{type:String,default:""},createDisabled:{type:Boolean,default:!1},updateDisabled:{type:Boolean,default:!1},dropDisabled:{type:Boolean,default:!1},saveValidator:{type:Function,required:!1,default:()=>!0}},emits:["update:modelValue","read","create","update","drop","perms","error","modified-data"],setup(r,{expose:C,emit:$}){const t=r,v=e.useSlots(),n=$;let j=[];const l=e.ref(!0),d=e.ref(t.modelValue),S=e.ref(j),u=e.ref(!1),s=e.ref(!1),c=e.ref(!1),i=e.ref(200),k=e.ref(null),h=e.ref(null),m=e.ref(new w.DataState(d.value)),H=e.computed(()=>t.isCreate?t.createConfirm:t.updateConfirm),A=e.computed(()=>t.isCreate?t.createResource:t.updateResource),F=e.computed(()=>t.isCreate?t.createData:t.updateData),P=e.computed(()=>t.isCreate?t.createDisabled:t.updateDisabled),D=async()=>{l.value=!0,i.value=-1;try{const a=await p.httpCall(t.readResource,t.readData);if(l.value=!1,!a.success){s.value=!1,i.value=a.httpStatus,n("error",a.httpStatus);return}s.value=!0,d.value=a.data,S.value=a.perms,m.value.increment(d.value).turnStoredIntoOriginal(),n("read",a)}catch{l.value=!1,s.value=!1,i.value=404,n("error",404);return}},U=e.computed(()=>l.value?!1:t.title||!!v["post-title"]);e.watch(()=>t.modelValue,a=>{d.value=a,m.value.increment(a)},{deep:!0}),e.watch(d,a=>{n("update:modelValue",d.value),m.value.increment(a)},{deep:!0}),e.watch(S,()=>n("perms",S.value));const B=e.computed(()=>P.value||typeof t.saveValidator=="function"&&!t.saveValidator(d.value)?!1:m.value.changed());e.watch(B,a=>n("modified-data",a)),t.readResource&&!t.isCreate?D():t.isCreate&&(s.value=!0,u.value=!0,l.value=!1);const z=(a,o)=>{if(l.value=!1,i.value=o.httpStatus,!o.success){c.value=!0,n("error",o.httpStatus);return}c.value=!0,n("drop",o)},G=(a,o)=>{if(l.value=!1,i.value=o.httpStatus,!o.success){c.value=!0,n("error",o.httpStatus);return}c.value=!0;let y=t.isCreate?"create":"update";t.isCreate||m.value.turnStoredIntoOriginal(),n(y,o)},b=()=>{l.value=!0,i.value=-1},g=()=>{l.value=!1};return C({doDrop:()=>{h.value&&typeof h.value.click=="function"&&h.value.click()},doRefresh:D,doSave:()=>{k.value&&typeof k.value.click=="function"&&k.value.click()}}),(a,o)=>{const y=e.resolveComponent("lkt-button"),J=e.resolveComponent("lkt-field-switch"),V=e.resolveComponent("lkt-http-info"),K=e.resolveComponent("lkt-loader");return e.openBlock(),e.createElementBlock("article",_,[U.value?(e.openBlock(),e.createElementBlock("header",q,[e.createElementVNode("h1",L,e.toDisplayString(r.title),1),e.createElementVNode("div",R,[e.renderSlot(a.$slots,"post-title",{item:d.value,loading:l.value})])])):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("div",E,[r.isCreate?e.createCommentVNode("",!0):e.withDirectives((e.openBlock(),e.createBlock(y,{key:0,ref:f=>h.value=f,palette:"danger",disabled:r.dropDisabled,"confirm-modal":r.dropConfirm,resource:r.dropResource,"resource-data":r.dropData,onLoading:b,onLoaded:g,onClick:z},{default:e.withCtx(()=>[e.unref(v)["button-drop"]?e.renderSlot(a.$slots,"button-drop",{key:0,item:d.value,editMode:u.value}):(e.openBlock(),e.createElementBlock("span",N,e.toDisplayString(r.dropText),1))]),_:3},8,["disabled","confirm-modal","resource","resource-data"])),[[e.vShow,!l.value&&u.value&&s.value]]),e.withDirectives(e.createVNode(y,{ref:f=>k.value=f,palette:"success",disabled:!B.value,"confirm-modal":H.value,resource:A.value,"resource-data":F.value,onLoading:b,onLoaded:g,onClick:G},{default:e.withCtx(()=>[e.unref(v)["button-save"]?e.renderSlot(a.$slots,"button-save",{key:0,item:d.value,editMode:u.value}):(e.openBlock(),e.createElementBlock("span",I,e.toDisplayString(r.saveText),1))]),_:3},8,["disabled","confirm-modal","resource","resource-data"]),[[e.vShow,!l.value&&u.value&&s.value]]),e.withDirectives(e.createVNode(J,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=f=>u.value=f),label:r.editModeText},null,8,["modelValue","label"]),[[e.vShow,!l.value&&s.value&&!r.isCreate]])],512),[[e.vShow,s.value]]),l.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",T,[s.value?(e.openBlock(),e.createElementBlock("div",x,[c.value?(e.openBlock(),e.createBlock(V,{key:0,code:i.value,quick:"",palette:i.value===200?"success":"danger","can-close":"",onClose:o[1]||(o[1]=f=>c.value=!1)},null,8,["code","palette"])):e.createCommentVNode("",!0),e.renderSlot(a.$slots,"item",{item:d.value,loading:l.value,editMode:u.value})])):(e.openBlock(),e.createBlock(V,{key:1,code:i.value},null,8,["code"]))])),l.value?(e.openBlock(),e.createBlock(K,{key:2})):e.createCommentVNode("",!0)])}}}),Q="";return{install:(r,C={})=>{r.component("LktItemCrud",O)}}});
