(function(e,p){typeof exports=="object"&&typeof module<"u"?module.exports=p(require("vue"),require("lkt-http-client"),require("lkt-data-state")):typeof define=="function"&&define.amd?define(["vue","lkt-http-client","lkt-data-state"],p):(e=typeof globalThis<"u"?globalThis:e||self,e.LktItemCrud=p(e.Vue,e.LktHttpClient,e.LktDataState))})(this,function(e,p,L){"use strict";const N={class:"lkt-item-crud"},R={key:0,class:"lkt-item-crud_header"},_={class:"lkt-item-crud_header-title"},I={class:"lkt-item-crud_header-slot"},O={class:"lkt-item-crud-buttons"},E={key:1},T={key:1},x={key:1,class:"lkt-item-crud_content"},M={key:0,class:"lkt-grid-1"},$={name:"LktItemCrud",inheritAttrs:!1},j=e.defineComponent({...$,props:{modelValue:{type:Object,required:!1,default:()=>({})},title:{type:String,default:""},editModeText:{type:String,default:"Edition Mode"},saveText:{type:String,default:"Save"},dropText:{type:String,default:"Delete"},readResource:{type:String,required:!0},createResource:{type:String,required:!1},updateResource:{type:String,required:!1},dropResource:{type:String,required:!1},readData:{type:Object,required:!1,default:()=>({})},createData:{type:Object,required:!1,default:()=>({})},updateData:{type:Object,required:!1,default:()=>({})},dropData:{type:Object,required:!1,default:()=>({})},isCreate:{type:Boolean,default:!1},createConfirm:{type:String,default:""},updateConfirm:{type:String,default:""},dropConfirm:{type:String,default:""},createDisabled:{type:Boolean,default:!1},updateDisabled:{type:Boolean,default:!1},dropDisabled:{type:Boolean,default:!1},saveValidator:{type:Function,required:!1,default:()=>!0}},emits:["update:modelValue","read","create","update","drop","perms","error","modified-data"],setup(l,{expose:g,emit:U}){const t=l,D=e.useSlots(),n=U;let J=[];const r=e.ref(!0),d=e.ref(t.modelValue),m=e.ref(J),u=e.ref(!1),i=e.ref(!1),c=e.ref(!1),s=e.ref(200),v=e.ref(null),h=e.ref(null),k=e.ref(new L.DataState(d.value)),H=e.computed(()=>t.isCreate?t.createConfirm:t.updateConfirm),A=e.computed(()=>t.isCreate?t.createResource:t.updateResource),F=e.computed(()=>t.isCreate?{...t.createData,...JSON.parse(JSON.stringify(d.value))}:{...t.updateData,...JSON.parse(JSON.stringify(d.value))}),P=e.computed(()=>t.isCreate?t.createDisabled:t.updateDisabled),C=e.computed(()=>!t.isCreate&&m.value.includes("update")),S=e.computed(()=>!t.isCreate&&m.value.includes("drop")),B=async()=>{r.value=!0,s.value=-1,c.value=!1;try{const a=await p.httpCall(t.readResource,t.readData);if(r.value=!1,s.value=a.httpStatus,!a.success){i.value=!1,s.value=a.httpStatus,n("error",a.httpStatus);return}i.value=!0,d.value=a.data,m.value=a.perms,k.value.increment(d.value).turnStoredIntoOriginal(),n("read",a)}catch{r.value=!1,i.value=!1,s.value=404,n("error",404);return}},z=e.computed(()=>r.value?!1:t.title||!!D["post-title"]);e.watch(()=>t.modelValue,a=>{d.value=a,k.value.increment(a)},{deep:!0}),e.watch(d,a=>{n("update:modelValue",d.value),k.value.increment(a)},{deep:!0}),e.watch(m,()=>n("perms",m.value));const b=e.computed(()=>P.value||!t.isCreate&&!C.value||typeof t.saveValidator=="function"&&!t.saveValidator(d.value)?!1:k.value.changed());e.watch(b,a=>n("modified-data",a)),t.readResource&&!t.isCreate?B():t.isCreate&&(i.value=!0,u.value=!0,r.value=!1);const G=(a,o)=>{if(r.value=!1,s.value=o.httpStatus,!o.success){c.value=!0,n("error",o.httpStatus);return}c.value=!0,n("drop",o)},K=(a,o)=>{if(r.value=!1,s.value=o.httpStatus,!o.success){c.value=!0,n("error",o.httpStatus);return}c.value=!0;let y=t.isCreate?"create":"update";t.isCreate||k.value.turnStoredIntoOriginal(),o.autoReloadId&&(t.readData.id=o.autoReloadId,B()),n(y,o)},V=()=>{r.value=!0,s.value=-1},w=()=>{r.value=!1};return g({doDrop:()=>{h.value&&typeof h.value.click=="function"&&h.value.click()},doRefresh:B,doSave:()=>{v.value&&typeof v.value.click=="function"&&v.value.click()}}),(a,o)=>{const y=e.resolveComponent("lkt-button"),Q=e.resolveComponent("lkt-field-switch"),q=e.resolveComponent("lkt-http-info"),W=e.resolveComponent("lkt-loader");return e.openBlock(),e.createElementBlock("article",N,[z.value?(e.openBlock(),e.createElementBlock("header",R,[e.createElementVNode("h1",_,e.toDisplayString(l.title),1),e.createElementVNode("div",I,[e.renderSlot(a.$slots,"post-title",{item:d.value,loading:r.value})])])):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("div",O,[l.isCreate?e.createCommentVNode("",!0):e.withDirectives((e.openBlock(),e.createBlock(y,{key:0,ref:f=>h.value=f,palette:"danger",disabled:l.dropDisabled||!S.value,"confirm-modal":l.dropConfirm,resource:l.dropResource,"resource-data":l.dropData,onLoading:V,onLoaded:w,onClick:G},{default:e.withCtx(()=>[e.unref(D)["button-drop"]?e.renderSlot(a.$slots,"button-drop",{key:0,item:d.value,editMode:u.value,isCreate:l.isCreate,canUpdate:C.value,canDrop:S.value}):(e.openBlock(),e.createElementBlock("span",E,e.toDisplayString(l.dropText),1))]),_:3},8,["disabled","confirm-modal","resource","resource-data"])),[[e.vShow,!r.value&&u.value&&i.value]]),e.withDirectives(e.createVNode(y,{ref:f=>v.value=f,palette:"success",disabled:!b.value,"confirm-modal":H.value,resource:A.value,"resource-data":F.value,onLoading:V,onLoaded:w,onClick:K},{default:e.withCtx(()=>[e.unref(D)["button-save"]?e.renderSlot(a.$slots,"button-save",{key:0,item:d.value,editMode:u.value,isCreate:l.isCreate,canUpdate:C.value,canDrop:S.value}):(e.openBlock(),e.createElementBlock("span",T,e.toDisplayString(l.saveText),1))]),_:3},8,["disabled","confirm-modal","resource","resource-data"]),[[e.vShow,!r.value&&u.value&&i.value]]),e.withDirectives(e.createVNode(Q,{modelValue:u.value,"onUpdate:modelValue":o[0]||(o[0]=f=>u.value=f),label:l.editModeText},null,8,["modelValue","label"]),[[e.vShow,!r.value&&i.value&&!l.isCreate]])],512),[[e.vShow,i.value]]),r.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",x,[i.value?(e.openBlock(),e.createElementBlock("div",M,[c.value?(e.openBlock(),e.createBlock(q,{key:0,code:s.value,quick:"",palette:s.value===200?"success":"danger","can-close":"",onClose:o[1]||(o[1]=f=>c.value=!1)},null,8,["code","palette"])):e.createCommentVNode("",!0),e.renderSlot(a.$slots,"item",{item:d.value,loading:r.value,editMode:u.value,isCreate:l.isCreate,canUpdate:C.value,canDrop:S.value})])):(e.openBlock(),e.createBlock(q,{key:1,code:s.value},null,8,["code"]))])),r.value?(e.openBlock(),e.createBlock(W,{key:2})):e.createCommentVNode("",!0)])}}}),X="";return{install:(l,g={})=>{l.component("LktItemCrud",j)}}});
