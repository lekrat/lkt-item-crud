(function(e,p){typeof exports=="object"&&typeof module<"u"?module.exports=p(require("vue"),require("lkt-http-client"),require("lkt-data-state"),require("lkt-button"),require("lkt-http-info"),require("lkt-loader")):typeof define=="function"&&define.amd?define(["vue","lkt-http-client","lkt-data-state","lkt-button","lkt-http-info","lkt-loader"],p):(e=typeof globalThis<"u"?globalThis:e||self,e.LktItemCrud=p(e.Vue,e.LktHttpClient,e.LktDataState,e.LktButton,e.LktHttpInfo,e.LktLoader))})(this,function(e,p,N,R,I,O){"use strict";const D=t=>t&&typeof t=="object"&&"default"in t?t:{default:t},E=D(R),T=D(I),x=D(O),M={class:"lkt-item-crud"},j={key:0,class:"lkt-item-crud_header"},$={class:"lkt-item-crud_header-title"},U={class:"lkt-item-crud_header-slot"},H={class:"lkt-item-crud-buttons"},J={key:1},A={key:1},F={key:1,class:"lkt-item-crud_content"},P={key:0,class:"lkt-grid-1"},z={name:"LktItemCrud",inheritAttrs:!1},G=e.defineComponent({...z,props:{modelValue:{type:Object,required:!1,default:()=>({})},title:{type:String,default:""},editModeText:{type:String,default:"Edition Mode"},saveText:{type:String,default:"Save"},dropText:{type:String,default:"Delete"},readResource:{type:String,required:!1},createResource:{type:String,required:!1},updateResource:{type:String,required:!1},dropResource:{type:String,required:!1},readData:{type:Object,required:!1,default:()=>({})},createData:{type:Object,required:!1,default:()=>({})},updateData:{type:Object,required:!1,default:()=>({})},dropData:{type:Object,required:!1,default:()=>({})},isCreate:{type:Boolean,default:!1},createConfirm:{type:String,default:""},updateConfirm:{type:String,default:""},dropConfirm:{type:String,default:""},createDisabled:{type:Boolean,default:!1},updateDisabled:{type:Boolean,default:!1},dropDisabled:{type:Boolean,default:!1},saveValidator:{type:Function,required:!1,default:()=>!0}},emits:["update:modelValue","read","create","update","drop","perms","error","modified-data"],setup(t,{expose:g,emit:K}){const a=t,B=e.useSlots(),n=K;let Q=[];const o=e.ref(!0),d=e.ref(a.modelValue),m=e.ref(Q),u=e.ref(!1),i=e.ref(!1),c=e.ref(!1),s=e.ref(200),v=e.ref(null),h=e.ref(null),k=e.ref(new N.DataState(d.value)),W=e.computed(()=>a.isCreate?a.createConfirm:a.updateConfirm),L=e.computed(()=>a.isCreate?a.createResource:a.updateResource),X=e.computed(()=>a.isCreate?{...a.createData,...JSON.parse(JSON.stringify(d.value))}:{...a.updateData,...JSON.parse(JSON.stringify(d.value))}),Y=e.computed(()=>a.isCreate?a.createDisabled:a.updateDisabled),C=e.computed(()=>!a.isCreate&&m.value.includes("update")),y=e.computed(()=>!a.isCreate&&m.value.includes("drop")),b=async()=>{o.value=!0,s.value=-1,c.value=!1;try{const l=await p.httpCall(a.readResource,a.readData);if(o.value=!1,s.value=l.httpStatus,!l.success){i.value=!1,s.value=l.httpStatus,n("error",l.httpStatus);return}i.value=!0,d.value=l.data,m.value=l.perms,k.value.increment(d.value).turnStoredIntoOriginal(),n("read",l)}catch{o.value=!1,i.value=!1,s.value=404,n("error",404);return}},Z=e.computed(()=>o.value?!1:a.title||!!B["post-title"]);e.watch(()=>a.modelValue,l=>{d.value=l,k.value.increment(l)},{deep:!0}),e.watch(d,l=>{n("update:modelValue",d.value),k.value.increment(l)},{deep:!0}),e.watch(m,()=>n("perms",m.value));const V=e.computed(()=>Y.value||!a.isCreate&&!C.value||typeof a.saveValidator=="function"&&!a.saveValidator(d.value)?!1:k.value.changed());e.watch(V,l=>n("modified-data",l)),a.readResource&&!a.isCreate?b():a.isCreate&&(i.value=!0,u.value=!0,o.value=!1);const ee=(l,r)=>{if(o.value=!1,s.value=r.httpStatus,!r.success){c.value=!0,n("error",r.httpStatus);return}c.value=!0,n("drop",r)},te=(l,r)=>{if(L.value){if(o.value=!1,s.value=r.httpStatus,!r.success){c.value=!0,n("error",r.httpStatus);return}c.value=!0}let S=a.isCreate?"create":"update";a.isCreate||k.value.turnStoredIntoOriginal(),r.autoReloadId&&(a.readData.id=r.autoReloadId,b()),n(S,r)},w=()=>{o.value=!0,s.value=-1},_=()=>{o.value=!1};return g({doDrop:()=>{h.value&&typeof h.value.click=="function"&&h.value.click()},doRefresh:b,doSave:()=>{v.value&&typeof v.value.click=="function"&&v.value.click()}}),(l,r)=>{const S=e.resolveComponent("lkt-button"),ae=e.resolveComponent("lkt-field-switch"),q=e.resolveComponent("lkt-http-info"),le=e.resolveComponent("lkt-loader");return e.openBlock(),e.createElementBlock("article",M,[Z.value?(e.openBlock(),e.createElementBlock("header",j,[e.createElementVNode("h1",$,e.toDisplayString(t.title),1),e.createElementVNode("div",U,[e.renderSlot(l.$slots,"post-title",{item:d.value,loading:o.value})])])):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("div",H,[t.isCreate?e.createCommentVNode("",!0):e.withDirectives((e.openBlock(),e.createBlock(S,{key:0,ref:f=>h.value=f,palette:"danger",disabled:t.dropDisabled||!y.value,"confirm-modal":t.dropConfirm,resource:t.dropResource,"resource-data":t.dropData,onLoading:w,onLoaded:_,onClick:ee},{default:e.withCtx(()=>[e.unref(B)["button-drop"]?e.renderSlot(l.$slots,"button-drop",{key:0,item:d.value,editMode:u.value,isCreate:t.isCreate,canUpdate:C.value,canDrop:y.value}):(e.openBlock(),e.createElementBlock("span",J,e.toDisplayString(t.dropText),1))]),_:3},8,["disabled","confirm-modal","resource","resource-data"])),[[e.vShow,!o.value&&u.value&&i.value]]),e.withDirectives(e.createVNode(S,{ref:f=>v.value=f,palette:"success",disabled:!V.value,"confirm-modal":W.value,resource:L.value,"resource-data":X.value,onLoading:w,onLoaded:_,onClick:te},{default:e.withCtx(()=>[e.unref(B)["button-save"]?e.renderSlot(l.$slots,"button-save",{key:0,item:d.value,editMode:u.value,isCreate:t.isCreate,canUpdate:C.value,canDrop:y.value}):(e.openBlock(),e.createElementBlock("span",A,e.toDisplayString(t.saveText),1))]),_:3},8,["disabled","confirm-modal","resource","resource-data"]),[[e.vShow,!o.value&&u.value&&i.value]]),e.withDirectives(e.createVNode(ae,{modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=f=>u.value=f),label:t.editModeText},null,8,["modelValue","label"]),[[e.vShow,!o.value&&i.value&&!t.isCreate]])],512),[[e.vShow,i.value]]),o.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",F,[i.value?(e.openBlock(),e.createElementBlock("div",P,[c.value?(e.openBlock(),e.createBlock(q,{key:0,code:s.value,quick:"",palette:s.value===200?"success":"danger","can-close":"",onClose:r[1]||(r[1]=f=>c.value=!1)},null,8,["code","palette"])):e.createCommentVNode("",!0),e.renderSlot(l.$slots,"item",{item:d.value,loading:o.value,editMode:u.value,isCreate:t.isCreate,canUpdate:C.value,canDrop:y.value})])):(e.openBlock(),e.createBlock(q,{key:1,code:s.value},null,8,["code"]))])),o.value?(e.openBlock(),e.createBlock(le,{key:2})):e.createCommentVNode("",!0)])}}}),oe="";return{install:(t,g={})=>{t.component("lkt-item-crud")===void 0&&t.component("lkt-item-crud",G),t.component("lkt-button")===void 0&&t.use(E.default),t.component("lkt-http-info")===void 0&&t.use(T.default),t.component("lkt-loader")===void 0&&t.use(x.default)}}});
